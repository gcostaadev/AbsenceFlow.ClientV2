@page "/colaboradores/detalhe/{id:int}"
@inject NavigationManager Navigation
@inject AbsenceFlow.ClientV2.Services.IColaboradorApiService ColaboradorService

@using AbsenceFlow.ClientV2.Models

<PageTitle>Detalhes do Colaborador</PageTitle>

<h3 class="text-primary mb-4">
    <i class="bi bi-person-vcard me-2"></i> Detalhes do Colaborador
</h3>

@if (isLoading)
{
    <div class="d-flex justify-content-center p-5">
        <div class="spinner-border text-primary"></div>
    </div>
}
else if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="alert alert-danger">@errorMessage</div>
}
else if (colaborador is null)
{
    <div class="alert alert-warning">Colaborador não encontrado.</div>
}
else
{
    <div class="card shadow p-4">

        <h4 class="text-secondary mb-4">
            <i class="bi bi-person-lines-fill me-2"></i> @colaborador.NomeCompleto
        </h4>

        <div class="row mb-3">
            <div class="col-md-6">
                <strong>ID:</strong> @colaborador.Id
            </div>
            <div class="col-md-6">
                <strong>Email Corporativo:</strong> @colaborador.EmailCorporativo
            </div>
        </div>

        <div class="row mb-3">
            <div class="col-md-6">
                <strong>Data de Contratação:</strong> @colaborador.DataContratacao.ToShortDateString()
            </div>
            <div class="col-md-6">
                <strong>Saldo de Férias:</strong> @colaborador.SaldoDiasFerias dias
            </div>
        </div>

        <div class="mb-3">
            <strong>Cadastrado em:</strong> @colaborador.CreatedAt.ToString("dd/MM/yyyy HH:mm")
        </div>

        <div class="mt-4 d-flex gap-2">
            <button class="btn btn-secondary" @onclick="Voltar">
                <i class="bi bi-arrow-left me-2"></i> Voltar
            </button>

            <button class="btn btn-danger" @onclick="Excluir">
                <i class="bi bi-trash me-2"></i> Excluir
            </button>
        </div>
    </div>
}

@code {

    [Parameter] public int id { get; set; }

    private ColaboradorViewModel? colaborador;
    private bool isLoading = true;
    private string errorMessage = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        await LoadColaborador();
    }

    private async Task LoadColaborador()
    {
        try
        {
            colaborador = await ColaboradorService.GetColaboradorByIdAsync(id);
        }
        catch (Exception ex)
        {
            errorMessage = $"Erro ao carregar colaborador: {ex.Message}";
        }
        finally
        {
            isLoading = false;
        }
    }

    private void Voltar()
    {
        Navigation.NavigateTo("/colaboradores/lista");
    }

    private async Task Excluir()
    {
        var confirm = await js.InvokeAsync<bool>("confirm",
            $"Tem certeza que deseja excluir o colaborador '{colaborador?.NomeCompleto}'?");

        if (!confirm)
            return;

        try
        {
            await ColaboradorService.DeleteColaboradorAsync(id);
            Navigation.NavigateTo("/colaboradores/lista");
        }
        catch (Exception ex)
        {
            errorMessage = $"Erro ao excluir colaborador: {ex.Message}";
        }
    }

    [Inject] IJSRuntime js { get; set; }
}
